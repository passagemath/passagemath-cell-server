# HG changeset patch
# User Jason Grout <jason.grout@drake.edu>
# Parent 9e8f484ff55f54e28200e8cb6d692b97d4d81562
Changes for Sage Cell Server 2.0

diff --git a/sage/misc/html.py b/sage/misc/html.py
--- a/sage/misc/html.py
+++ b/sage/misc/html.py
@@ -186,7 +186,7 @@
                 return ''
             elif EMBEDDED_MODE['frontend']=='sagecell':
                 import sys
-                sys._sage_messages.message_queue.display({'text/html':"<font color='black'>%s</font>"%t})
+                sys._sage_.display_message({'text/plain': 'table', 'text/html': "<font color='black'>%s</font>"%t})
                 return ''
         else:
             return ''
@@ -295,7 +295,7 @@
                 print "<html>"+output_string+"</html>"
             elif EMBEDDED_MODE['frontend']=='sagecell':
                 import sys
-                sys._sage_messages.message_queue.display({'text/html':output_string})
+                sys._sage_.display_message({'text/plain': 'html snippet', 'text/html': output_string})
 
     def table_str(self, x, header):
         import types
diff --git a/sage/misc/latex.py b/sage/misc/latex.py
--- a/sage/misc/latex.py
+++ b/sage/misc/latex.py
@@ -2016,7 +2016,7 @@
             if misc.EMBEDDED_MODE['frontend']=='sagecell':
                 mathexpr=mathjax_expr.replace('<html>','').replace('</html>','')
                 import sys
-                sys._sage_messages.message_queue.display({'text/html':mathexpr})
+                sys._sage_.display_message({'text/plain': 'math', 'text/html': mathexpr})
             else:
                 print mathjax_expr  # put comma at end of line?
         else:
@@ -2031,7 +2031,7 @@
                 sys._sage_upload_file_pipe.send_bytes(json.dumps([png_file]))
                 sys._sage_upload_file_pipe.recv_bytes() # confirmation upload happened
                 msg={'text/filename': png_file}
-                sys._sage_messages.message_queue.display(msg)
+                sys._sage_.display_message(msg)
             else:
                 print '<html><img src="%s"></html>'%png_link  # put comma at end of line?
         return
diff --git a/sage/plot/animate.py b/sage/plot/animate.py
--- a/sage/plot/animate.py
+++ b/sage/plot/animate.py
@@ -395,7 +395,7 @@
                     sys._sage_upload_file_pipe.send_bytes(json.dumps([savefile]))
                     sys._sage_upload_file_pipe.recv_bytes() # confirmation upload happened
                     msg={'text/filename': os.path.basename(savefile)}
-                    sys._sage_messages.message_queue.display(msg)
+                    sys._sage_.display_message(msg)
 
                 if show_path:
                     print "Animation saved to file %s." % savefile
diff --git a/sage/plot/graphics.py b/sage/plot/graphics.py
--- a/sage/plot/graphics.py
+++ b/sage/plot/graphics.py
@@ -1517,7 +1517,7 @@
             else:
                 if sage.misc.misc.EMBEDDED_MODE['frontend']=='sagecell':
                     msg={'text/filename': filename}
-                    sys._sage_messages.message_queue.display(msg)
+                    sys._sage_.display_message(msg)
                 else:
                     html("<img src='cell://%s'>"%filename)
         else:
@@ -2648,7 +2648,7 @@
                 sys._sage_upload_file_pipe.send_bytes(json.dumps([filename]))
                 sys._sage_upload_file_pipe.recv_bytes() # confirmation upload happened
                 msg={'text/filename': filename}
-                sys._sage_messages.message_queue.display(msg)
+                sys._sage_.display_message(msg)
             return
         self._render(filename, dpi=dpi, figsize=self._figsize, axes = axes, **args)
         os.system('%s %s 2>/dev/null 1>/dev/null &'%(
diff --git a/sage/plot/plot3d/base.pyx b/sage/plot/plot3d/base.pyx
--- a/sage/plot/plot3d/base.pyx
+++ b/sage/plot/plot3d/base.pyx
@@ -1101,7 +1101,7 @@
                 sys._sage_upload_file_pipe.send_bytes(json.dumps([filename_full]))
                 sys._sage_upload_file_pipe.recv_bytes() # confirmation upload happened
                 msg['text/filename']=filename_full
-                sys._sage_messages.message_queue.display(msg)
+                sys._sage_.display_message(msg)
 
             import sage.misc.viewer
             viewer_app = sage.misc.viewer.browser()
@@ -1144,7 +1144,7 @@
                 sys._sage_upload_file_pipe.send_bytes(json.dumps([archive_name]))
                 sys._sage_upload_file_pipe.recv_bytes() # confirmation upload happened
                 msg['application/x-jmol']=archive_name
-                sys._sage_messages.message_queue.display(msg)
+                sys._sage_.display_message(msg)
 
             else:
                 # We need a script to load the file
diff --git a/sage/plot/plot3d/tachyon.py b/sage/plot/plot3d/tachyon.py
--- a/sage/plot/plot3d/tachyon.py
+++ b/sage/plot/plot3d/tachyon.py
@@ -324,7 +324,7 @@
                 sys._sage_upload_file_pipe.send_bytes(json.dumps([filename]))
                 sys._sage_upload_file_pipe.recv_bytes() # confirmation upload happened
                 msg={'text/filename': filename}
-                sys._sage_messages.message_queue.display(msg)
+                sys._sage_.display_message(msg)
             return
         filename = sage.misc.misc.tmp_filename() + '.png'
         self.save(filename, verbose=verbose, extra_opts=extra_opts)
